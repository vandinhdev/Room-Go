<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROOM GO - Cho Thuê Phòng Trọ</title>
    <link rel="stylesheet" href="access/css/styles.css">
    <link rel="stylesheet" href="access/css/filters.css">
    <link rel="stylesheet" href="access/css/footer.css">
    <link rel="stylesheet" href="access/css/user.css">
    <link rel="stylesheet" href="access/css/pagination.css">
    <link rel="stylesheet" href="access/css/responsive.css">
    <link rel="stylesheet" href="access/css/auth.css">
    <link rel="stylesheet" href="access/css/favourite.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>
<body>
   

    <!-- Main Container -->
    <div class="main-container">
    

        <!-- Filters -->
        <div class="filters">
            <div class="filter-btn primary-filter">
                <i class="fa-solid fa-sliders"></i>
                <span>Lọc</span>
            </div>
            <div class="filter-group">
                <select id="priceFilter" class="filter-select">
                    <option value="">Giá thuê</option>
                    <option value="1">Dưới 1 triệu</option>
                    <option value="2">1-2 triệu</option>
                    <option value="3">2-3 triệu</option>
                    <option value="4">Trên 3 triệu</option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
            </div>
            <div class="filter-group">
                <select id="areaFilter" class="filter-select">
                    <option value="">Diện tích</option>
                    <option value="1">Dưới 15m²</option>
                    <option value="2">15-25m²</option>
                    <option value="3">25-35m²</option>
                    <option value="4">Trên 35m²</option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
            </div>
            <div class="filter-group">
                <select id="districtSelect" class="filter-select">
                    <option value="">Quận/Huyện</option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
            </div>
            <div class="filter-group">
                <select id="wardSelect" class="filter-select">
                    <option value="">Phường/Xã</option>
                </select>
                <i class="fa-solid fa-chevron-down select-icon"></i>
            </div>
            <button class="clear-filters">
                <i class="fa-solid fa-xmark"></i>
                <span>Xoá lọc</span>
            </button>
        </div>

        <!-- Category Tags -->
        

        <!-- Content Tabs -->
        <div class="content-tabs">
            <div class="tab active">Tất cả</div>
            <div class="tab">Cá nhân</div>
        </div>

        <!-- Sort & View Controls -->
        <div class="sort-view-controls">
            <div class="sort-control">
                <span>Tin mới nhất</span>
            </div>
            
        </div>

        <!-- Listings Grid -->
        <div class="listings-grid" id="listingsGrid">
            <!-- Cards sẽ được render bằng JS -->
        </div>

        <!-- Pagination -->
        <div id="paginationContainer" class="pagination-container"></div>
    </div>

    <script type="module" src="./js/main.js" defer></script>
    <script>
        // Xử lý lọc tỉnh thành, giá, diện tích
        function initializeFilters() {
            const provinceSelect = document.getElementById('provinceSelect');
            const priceFilter = document.getElementById('priceFilter');
            const areaFilter = document.getElementById('areaFilter');
            const clearBtn = document.querySelector('.clear-filters');
            
            // Lưu lại hàm renderRooms từ main.js
            let roomsData = window.roomsData || [];
            if (!roomsData.length && window.rooms) roomsData = window.rooms;
            
            function getFilteredRooms() {
                let filtered = roomsData;
                // Lọc tỉnh thành (kiểm tra tồn tại trước khi sử dụng)
                if (provinceSelect && provinceSelect.value) {
                    const province = provinceSelect.value;
                    filtered = filtered.filter(r => r.address && r.address.includes(province));
                }
                // Lọc giá
                if (priceFilter && priceFilter.value) {
                    switch (priceFilter.value) {
                        case '1': filtered = filtered.filter(r => r.price < 1000000); break;
                        case '2': filtered = filtered.filter(r => r.price >= 1000000 && r.price <= 2000000); break;
                        case '3': filtered = filtered.filter(r => r.price > 2000000 && r.price <= 3000000); break;
                        case '4': filtered = filtered.filter(r => r.price > 3000000); break;
                    }
                }
                // Lọc diện tích
                if (areaFilter && areaFilter.value) {
                    switch (areaFilter.value) {
                        case '1': filtered = filtered.filter(r => r.area < 15); break;
                        case '2': filtered = filtered.filter(r => r.area >= 15 && r.area <= 25); break;
                        case '3': filtered = filtered.filter(r => r.area > 25 && r.area <= 35); break;
                        case '4': filtered = filtered.filter(r => r.area > 35); break;
                    }
                }
                return filtered;
            }
            
            function updateRooms() {
                if (window.renderRooms) {
                    window.renderRooms(getFilteredRooms());
                }
            }
            
            // Chỉ thêm event listener nếu element tồn tại
            if (provinceSelect) {
                provinceSelect.addEventListener('change', updateRooms);
            }
            if (priceFilter) {
                priceFilter.addEventListener('change', updateRooms);
            }
            if (areaFilter) {
                areaFilter.addEventListener('change', updateRooms);
            }
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    if (provinceSelect) provinceSelect.value = '';
                    if (priceFilter) priceFilter.value = '';
                    if (areaFilter) areaFilter.value = '';
                    updateRooms();
                });
            }
        }
        
        // Khởi tạo filters sau khi DOM load
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilters();
        });
        
        // Khởi tạo lại filters sau khi header load
        document.addEventListener('headerLoaded', function() {
            initializeFilters();
        });
    </script>
    <script type="module" src="js/header.js"></script>
    <script src="js/footer.js"></script>
</body>
</html>